define(["jquery","jqueryui","core/log"],function(p,e,r){var t,n,o,i,s,a,l,c,d,u,f,g,h,v,m,y,L={},b=(L.doNothing=p.noop,L.returnFalse=function(){return!1},!(L.returnTrue=function(){return!0}));function w(e,t,n,o){return void 0!==j[e]&&clearTimeout(j[e]),setTimeout(function(){0<_?j[e]=w(e,t,n,o):(t(n,o),delete j[e])},100)}L.log=function(e,t){(b||t)&&r.debug(e)},L.setUserPreferences=function(e){p.ajax({async:!0,type:"POST",url:"../editor/userpreferences.json.php",data:JSON.stringify(e),contentType:"application/json; charset=utf-8",dataType:"json"})},L.getUserPreferences=function(e){p.ajax({async:!0,type:"POST",url:"../editor/userpreferences.json.php",data:JSON.stringify({getPreferences:!0}),contentType:"application/json; charset=utf-8",dataType:"json"}).done(e)},L.scrollBarWidth=function(){var e=p('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body"),t=e.children(),t=t.innerWidth()-t.height(99).innerWidth();return e.remove(),t},L.sanitizeHTML=function(e){return void 0===e||""==e.replace(/^\s+$/g,"")?"":p("<div>"+e+"</div>").html()},L.sanitizeText=function(e){return void 0===e||""==e.replace(/^\s+$/g,"")?"":e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},L.setProtocol=function(e){var t;if(0==e.securePort||0==e.port)t=0==e.port;else switch(e.wsProtocol){case"always_use_wss":t=!0;break;case"always_use_ws":t=!1;break;default:t="https:"==window.location.protocol}var n=(t?"wss://":"ws://")+e.server;e.secure=t,e.portToUse=t?e.securePort:e.port,n+=":"+e.portToUse+"/",e.monitorURL=n+e.monitorPath,e.executionURL=n+e.executionPath},L.ArrayBuffer2String=function(e){for(var t=new Uint8Array(e),n=[],o=0,r=t.length;o<r;o+=32e3)n.push(String.fromCharCode.apply(String,t.subarray(o,Math.min(o+32e3,r))));return n.join("")},L.String2ArrayBuffer=function(e){for(var t=e.length,n=new ArrayBuffer(t),o=new Uint8Array(n),r=0;r<t;r++)o[r]=e.charCodeAt(r);return n},t=0,L.getUniqueId=function(){return t++},n=/\.([^.]*)$/,o=/^(gif|jpg|jpeg|png|ico)$/i,i=/^(zip|jar|pdf|tar|bin|7z|arj|deb|gzip|rar|rpm|dat|db|dll|rtf|doc|docx|odt|exe|com)$/i,s=/^blockly[0123]?$/,L.fileExtension=function(e){e=n.exec(e);return null!==e?e[1]:""},L.isImage=function(e){return o.test(L.fileExtension(e))},L.isBinary=function(e){return L.isImage(e)||i.test(L.fileExtension(e))},L.isBlockly=function(e){return s.test(L.fileExtension(e))},a=/[\cA-\cZ]|[:-@]|[{-~]|\\|\[|\]|[/^`Â´]|^-|^ | $|\.\./,L.validFileName=function(e){return!(e.length<1||128<e.length||a.test(e))},L.getCurrentTime=function(){return parseInt((new Date).valueOf()/1e3)},L.encodeBinary=function(e,t){return L.isBinary(e)?btoa(L.ArrayBuffer2String(t)):btoa(unescape(encodeURIComponent(t)))},L.decodeBinary=function(e,t){t=atob(t);return L.isBinary(e)?L.String2ArrayBuffer(t):decodeURIComponent(escape(t))},L.validPath=function(e){if(256<e.length)return!1;for(var t=e.split("/"),n=0;n<t.length;n++)if(!L.validFileName(t[n]))return!1;return!0},L.getFileName=function(e){e=e.split("/");return e[e.length-1]},L.dataFromURLData=function(e){return e.substr(e.indexOf(",")+1)},L.readZipFile=function(e,i,s,a){var t,l,c;a=a||L.doNothing,"undefined"==typeof JUnzip?L.loadScript(["../editor/zip/inflate.js","../editor/zip/unzip.js"],function(){L.readZipFile(e,i,s,a)}):(t=L.ArrayBuffer2String(e),(l=new JUnzip(t)).isZipFile()?(l.readEntries(),c=l.entries.length,function t(n){var o,e,r;c<=n||s.isClosed()?a():(r=l.entries[n],(o=r.fileName).match(/\/$/)?t(n+1):(s.processFile(o),e="",0===r.compressionMethod?e=r.data:8===r.compressionMethod&&(e=JSInflate.inflate(r.data)),L.isBinary(o)?(i({name:o,contents:btoa(e),encoding:1}),t(n+1)):(r=L.String2ArrayBuffer(e),e=new Blob([r],{type:"text/plain"}),(r=new FileReader).onload=function(e){i({name:o,contents:e.target.result,encoding:0}),t(n+1)},r.onerror=function(e){L.log(e),t((n=c)+1)},r.readAsText(e))))}(0)):(L.log("Not a ZIP file"),a()))},L.readSelectedFiles=function(t,a,l){var c=new L.progressBar("import","import"),d="";l=l||L.doNothing,c.processFile=function(e){c.setLabel(e)},function n(o){var r,i,e,s;o>=t.length||c.isClosed()?(l(),c.close(),""<d&&L.showErrorMessage(d)):(r=t[o],c.processFile(r.name),i=L.isBinary(r.name),e=new FileReader,s=L.fileExtension(r.name).toLowerCase(),e.onload=function(e){if(i)if("zip"==s)try{return void L.readZipFile(e.target.result,a,c,function(){n(o+1)})}catch(e){L.showErrorMessage(e+" : "+r.name)}else{var t=L.dataFromURLData(e.target.result);a({name:r.name,contents:t,encoding:1})}else a({name:r.name,contents:e.target.result,encoding:0});n(o+1)},e.onerror=function(e){d+='Error "'+e.target.error+'" reading '+r.name+"\n",n(o+1)},i?"zip"==s?e.readAsArrayBuffer(r):e.readAsDataURL(r):e.readAsText(r))}(0)},l={gif:"image/gif",jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",ico:"image/vnd.microsoft.icon",pdf:"application/pdf"},L.getMIME=function(e){e=L.fileExtension(e);return e in l?l[e]:"application/octet-stream"},L.getTimeLeft=function(e){var t="",n=(e<0&&(t+="-",e=-e),e),o=parseInt(n/86400),o=(n-=86400*o,0!==o&&(t+=o+"T"),parseInt(n/3600)),r=(n-=3600*o,parseInt(n/60)),n=(n-=60*r,parseInt(n)),t=(t+=("00"+o).substr(-2)+":")+("00"+r).substr(-2);return e<3600&&(t+=":"+("00"+n).substr(-2)),t},c={abap:"abap",abc:"abc",ada:"ada",ads:"ada",adb:"ada",as:"actionscript",as3:"actionscript",asm:"assembly_x86",bash:"sh",bat:"batchfile",c:"c_cpp",C:"c_cpp",cc:"c_cpp",cpp:"c_cpp","c++":"c_cpp",hxx:"c_cpp",h:"c_cpp",H:"c_cpp",cases:"cases",cbl:"cobol",cob:"cobol",coffee:"coffee",clj:"clojure",cs:"csharp",css:"css",d:"d",dart:"dart",e:"eiffel",erl:"erlang",hrl:"erlang",f:"fortran",f77:"fortran",f90:"fortran",for:"fortran",go:"golang",groovy:"groovy",gv:"dot",hs:"haskell",htm:"html",html:"html",hx:"haxe",java:"java",jl:"julia",js:"javascript",json:"json",jsp:"jsp",jsx:"jsx",kt:"kotlin",kts:"kotlin",m:"matlab",md:"markdown",less:"less",lisp:"lisp",lsp:"lisp",lua:"lua",pas:"pascal",p:"pascal",perl:"perl",prl:"perl",php:"php",pro:"prolog",pl:"prolog",py:"python",R:"r",r:"r",rb:"ruby",ruby:"ruby",s:"assembly_x86",sass:"sass",scala:"scala",scm:"scheme",scss:"scss",sh:"sh",swift:"swift",sql:"sql",svg:"svg",tex:"tex",tcl:"tcl",ts:"typescript",twig:"twig",vbs:"vbscript",v:"verilog",vh:"verilog",vhd:"vhdl",vhdl:"vhdl",xml:"xml",yaml:"yaml"},L.langType=function(e){return e in c?c[e]:"plain_text"},d={},u=/\{\\*\$a\\*}/g,L.str=function(e,t){return d[e]?void 0!==t?d[e].replace(u,t):d[e]:"{"+e+"}"},L.setStr=function(e){for(var t in e)e.hasOwnProperty(t)&&(d[t]=e[t]);L.dialogbaseOptions={minWidth:200,autoOpen:!1,width:"auto",closeText:L.str("cancel"),modal:!0,dialogClass:"vpl_ide vpl_ide_dialog"}},L.setStr(window.VPLi18n);var x={},j={},_=0;function k(e,t){var n=this;this.files=e,this.results=t,setTimeout(function(){n.highlight()},10)}return L.delay=function(e,t,n,o){void 0!==x[e]&&(clearTimeout(x[e]),_--),_++,x[e]=setTimeout(function(){_--,t(n,o),delete x[e]},20)},L.longDelay=function(e,t,n,o){void 0!==x[e]&&(clearTimeout(x[e]),_--),_++,x[e]=setTimeout(function(){_--,t(n,o),delete x[e]},100)},L.afterAll=function(e,t,n,o){j[e]=w(e,t,n,o)},L.iconModified=function(){var e='<span title="'+L.str("modified")+'" class="vpl_ide_charicon">';return e+='<i class="fa fa-star"></i></span> '},L.iconDelete=function(){var e=' <span title="'+L.str("delete")+'" class="vpl_ide_charicon vpl_ide_delicon">';return e+='<i class="fa fa-trash"></i></span> '},L.iconClose=function(){var e=' <span title="'+L.str("closebuttontitle");return e+='" class="vpl_ide_charicon vpl_ide_closeicon"><i class="fa fa-remove"></i></span> '},L.iconRequired=function(){var e=' <span title="'+L.str("required")+'" class="vpl_ide_charicon">';return e+='<i class="fa fa-shield"></i></span> '},L.iconFolder=function(){return'<i class="fa fa-folder-open-o"></i>'},f={filelist:"folder-open-o",filelistclose:"folder-o",new:"file-code-o",rename:"pencil",delete:"trash",multidelete:"trash|list",close:"remove",comments:"commenting",import:"upload",print:"print",edit:"edit",undo:"undo",redo:"repeat",select_all:"location-arrow",find:"search",find_replace:"exchange",next:"search-plus",resetfiles:"refresh",download:"download",fullscreen:"expand",regularscreen:"compress",save:"save",shortcuts:"flash",sort:"list-ol",run:"rocket",running:"rocket fa-spin",debug:"bug",evaluate:"check-square-o",console:"terminal",about:"question",info:"info-circle",alert:"warning",trash:"trash",retrieve:"download",spinner:"refresh fa-spin",keyboard:"keyboard-o",clipboard:"clipboard",timeleft:"clock-o",copy:"copy",paste:"paste",more:"plus-square",less:"minus-square",resize:"arrows-alt",graphic:"picture-o",send:"send",theme:"paint-brush",user:"user-o",fontsize:"text-height","close-rightpanel":"caret-square-o-right","open-rightpanel":"caret-square-o-left","rts-on":"users","rts-off":"user"},L.genIcon=function(e,t){if(!f[e])return"";for(var n="fa fa-",o=(n+=t||"lg",f[e].split("|")),r="",i=0;i<o.length;i++)r+="<i class='"+n+" fa-"+o[i]+"'></i>";return r},L.setTitleBar=function(e,t,n,o,r){var i=p(e).parent().find("span.ui-dialog-title");for(var s,a,l=L.genIcon(n),e=(i.html(l=l+(" <span class='"+t+"-title-buttons'></span>")+("<span class='"+t+"-title-text'></span>")),i.find("span."+t+"-title-buttons")),n=i.find("span."+t+"-title-text"),l="",c=0;c<o.length;c++)l+=(s=o[c],a=void 0,a="<a id='vpl_"+t+"_"+s+"' href='#' title='"+L.str(s)+"'>",a+=L.genIcon(s,"fw")+"</a>");e.html(l);for(var d=0;d<r.length;d++){var u=i.find("#vpl_"+t+"_"+o[d]);u.button().click(r[d]),u.css("padding","1px 3px")}return e.on("focus","*",function(){p(this).blur()}),n},L.setDialogTitleIcon=function(e,t){e=p(e).parent().find("span.ui-dialog-title");e.html(L.genIcon(t)+" "+e.html())},L.progressBar=function(e,t,n){var o='<div class="vpl_ide_progressbaricon">'+L.genIcon("spinner")+"</div>",r=p('<div class="vpl_ide_dialog" style="display:none;">'+(' <div class="vpl_ide_progressbar">'+o+'<span class="vpl_ide_progressbarlabel"></span></div>')+"</div>");p("body").append(r);var i=r.find(".vpl_ide_progressbar").find(".vpl_ide_progressbarlabel"),o=(r.dialog({title:L.str(e),resizable:!1,autoOpen:!1,width:200,height:20,minHeight:20,modal:!0,dialogClass:"vpl_ide vpl_ide_dialog",close:function(e){r&&(n&&e.originalEvent&&n(),n=!1)}}),this.setLabel=function(e,t){r&&(i.text(e),t)&&i.html(L.genIcon(t)+" "+i.html())},this.close=function(){r&&(r.dialog("destroy"),p(r).remove(),r=!1)},this.isClosed=function(){return!1===r},r.siblings().find(".ui-dialog-title"));o.html(L.genIcon(e)+" "+o.html()),this.setLabel(L.str(t)),r.dialog("open"),r.dialog("option","height","auto")},L.showMessage=function(e,t){var n=p.extend({},L.dialogbaseOptions,t),o=p('<div class="vpl_ide_dialog" style="display:none"></div>'),r="",e=' <span class="dmessage">'+e.replace(/\n/g,"<br>")+"</span>",e=(o.html(e),void 0===n.icon?r="info":(r=n.icon,delete n.icon),n.title||(n.title=L.str("warning")),p("body").append(o),{}),e=("function"==typeof t.ok?(e[L.str("ok")]=function(){p(this).dialog("close"),t.ok()},e[L.str("cancel")]=function(){p(this).dialog("close")},delete n.ok):"function"==typeof t.yes?(e[L.str("yes")]=function(){p(this).dialog("close"),t.yes()},e[L.str("no")]=function(){p(this).dialog("close")},delete n.yes):e[L.str("close")]=function(){p(this).dialog("close")},n.next&&(e[L.str("next")]=function(){p(this).dialog("close"),t.next()}),n.close=function(){p(this).remove(),t.close&&t.close()},n.buttons=e,o.dialog(n),o.siblings().find(".ui-dialog-title"));return e.html(L.genIcon(r)+" "+e.html()),o.setMessage=function(e){p(o).find(".dmessage").html(e.replace(/\n/g,"<br>"))},o.dialog("open"),o},L.showErrorMessage=function(e,t){var n=p.extend({},L.dialogbaseOptions,{title:L.str("error"),icon:"alert"});return t&&(n=p.extend(n,t)),L.showMessage(e,n)},L.requestAction=function(e,t,n,o,r){var i=p.Deferred(),s=null,a=!1,l=!1;return r||(l=new L.progressBar(e,t=""===t?"connecting":t,function(){4!=s.readyState&&a&&a.abort&&a.abort()})),s=p.ajax({beforeSend:function(e){return a=e,!0},async:!0,type:"POST",url:o+e,data:JSON.stringify(n),contentType:"application/json; charset=utf-8",dataType:"json"}).always(function(){r||l.close()}).done(function(e){e.success?i.resolve(e.response):i.reject(e.error)}).fail(function(e,t,n){t=L.str("connection_fail")+": "+t;b&&null!=n.message&&(t+=": "+n.message),L.log(t),i.reject(t)}),i},L.supportWebSocket=function(){return"WebSocket"in window},L.isAndroid=function(){return-1<window.navigator.userAgent.indexOf("Android")},L.isFirefox=function(){return-1<window.navigator.userAgent.indexOf("Firefox")},L.isMac=function(){return-1<window.navigator.userAgent.indexOf("Mac")},L.clickServer=function(e){var t=screen.width/2-275,n=screen.height/2-225;try{var o=(o="toolbar=no, location=no, directories=no, status=no, menubar=no")+", resizable=yes, scrollbars=yes, copyhistory=no, width=550"+(", height=450, top="+n+", left="+t);if(!window.open(p(this).attr("href"),"_blank",o))return!0}catch(e){return L.log(e),!0}return e.preventDefault(),p(this).parent().hide(),!1},L.acceptCertificates=function(e,t){if(0<e.length){var n,o=L.str("acceptcertificatesnote");for(n in o+="<ol>",e)e.hasOwnProperty(n)&&(o=o+('<li><a href="'+e[n])+'" target="_blank">Server '+(1+n)+"</a></li>");var r=L.showMessage(o+="</ol>",{ok:function(){var e=t();e&&e()},icon:"unlocked",title:L.str("acceptcertificates")});p(r).find("a").on("click keypress",L.clickServer)}else L.log("servers.length == 0"),L.showErrorMessage(L.str("connection_fail"))},L.monitorRunning=L.returnFalse,g=-1,L.setProcessId=function(e){g=e},L.getProcessId=function(){return g},L.webSocketMonitor=function(t,e,n,o){L.setProtocol(t),L.setProcessId(t.processid);function r(e){a.reject(e)}var i=null,s=null,a=p.Deferred(),l=!1,c={message:function(e){var e=/^([^:]*):?([^]*)/.exec(e),t=e[1],e=e[2],t=L.str(t="running"==t?n:t);""<e&&(t+=": "+e),null===s||s.isClosed()?o.getConsole&&o.getConsole().isOpen()?o.getConsole().setMessage(t):L.log("Error: no dialogo. Message not shown: "+t):s.setLabel(t)},compilation:function(e){o.setResult&&o.setResult({compilation:e},!1)},retrieve:function(){var e={processid:L.getProcessId()};s.close(),l=!0,L.requestAction("retrieve","",e,o.ajaxurl).done(function(e){a.resolve(),o.setResult&&o.setResult(e,!0)}).fail(r)},run:function(e){s.close(),o.run(e,t,i)},close:function(){L.log("ws close message from jail"),i.close();var e={processid:L.getProcessId()};L.requestAction("cancel","",e,o.ajaxurl,!0)}};try{if(!L.supportWebSocket())return L.log("ws not available"),a.reject(L.str("browserupdate")),a;i=new WebSocket(t.monitorURL)}catch(e){return L.log("ws new say "+e),a.reject(e.message),a}return s=new L.progressBar(e,"connecting",function(){a.reject("Stopped by user"),i.close()}),i.notOpen=!0,i.onopen=function(){i.notOpen=!1,s.setLabel(L.str("connected")),o.open&&o.open()},i.onerror=function(e){L.log("ws error "+e),s.close(),t.secure&&i.notOpen?L.requestAction("getjails","retrieve",{},o.ajaxurl).done(function(e){L.acceptCertificates(e.servers,function(){return o.getLastAction()})}).fail(r):a.reject(L.str("connection_fail")),o.close&&L.delay("externalActions.close",o.close)},i.onclose=function(){o.getConsole&&o.getConsole().disconnect(),i.notOpen||(s.close(),l)||"rejected"==a.state()||a.resolve(),o.close&&o.close()},i.onmessage=function(e){var t,n=/^([^:]+):([^]*)/.exec(e.data);null!==n?(t=n[1],n=n[2],c[t]&&c[t](n)):s.setLabel(L.str("error")+": "+e.data)},L.monitorRunning=function(){return null!==i&&i.readyState!=WebSocket.CLOSED},a},L.directRun=function(e,t,n){var o=p.Deferred();return p.ajax({async:!0,type:"POST",url:e+"directrun",data:JSON.stringify({command:t,files:n}),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(e){var t,n;e.success?(t=e.response,L.setProtocol(t),n=new WebSocket(t.executionURL),r.debug("Conecting with:"+t.executionURL),o.resolve({processid:t.processid,homepath:t.homepath,connection:n})):o.reject(e.error)}).fail(function(e,t,n){t="Connection fail: "+t;null!=n.message&&(t+=": "+n.message),r.debug(t),o.reject(t)}),o},L.directRunTest=function(t,n,e){L.directRun(t,n,[{name:"a.c",contents:"int main(){return 0;}",encoding:0},{name:"b.c",contents:"int f(){return 1;}",encoding:0}]).done(function(t){var n=0;t.connection.onopen=function(){r.debug("Ws open "+t.homepath+" processid "+t.processid),null!=e&&t.connection.send(e),setTimeout(function(){t.connection.close()},6e5)},t.connection.onmessage=function(e){r.debug("WS Message ("+ ++n+"): "+e.data),10<=n&&t.connection.close()},t.connection.onerror=function(e){r.debug("WS error: "+e)},t.connection.onclose=function(e){r.debug("WS close: "+e.code+" "+e.reason)}}).fail(function(e){r.debug("Direct run fail. URL: "+t+" command: "+n+" message: "+e)})},L.processResult=function(e,d,u,t,n){if(void 0===e||""==e.replace(/^\s+$/gm,""))return"";function o(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/,"\\$&")}var r=/\([-]?[\d]+[.]?[\d]*\)\s*$/,i=/^-.*/,s=/^\s*>/,f=new RegExp("\\[err\\]|error|"+o(L.str("error")),"i"),p=new RegExp("\\[warn\\]|warning|note|"+o(L.str("warning")),"i"),g=new RegExp("\\[info\\]|information","i"),a="",l="",c="",h="",v=e.split(/\r\n|\n|\r/),m=[],y=!1,b=!1,w=!1;for(var x=0;x<d.length;x++){var j=o(d[x]);m[x]=new RegExp("(^| |/)"+j+"( on line | line |:|\\()(\\d+)(:|,)?(\\d+)?(\\))?","m")}function _(e,t){for(var n=!1,o=0;o<m.length;o++)for(var r,i=m[o];null!==(r=i.exec(e));){var s=u[o].getAnnotations(),a=(b=o,n=!0,a=-1<e.search(f)?"error":-1<e.search(p)?"warning":-1<e.search(g)?"info":"error",y={row:r[3]-1,column:r[5],type:a,text:t},s.push(y),d[o]),l=void 0===u[l=o].getTagId?'href="#" ':'href="#'+u[l].getTagId()+'" ',c=L.sanitizeText(a),a='data-file="'+a+'" data-line="'+r[3]+'"';e=e.replace(i,"$1<a "+l+' class="vpl_fl" '+a+">"+c+"$2$3$4$5$6</a>"),u[o].setAnnotations(s)}return!n&&y&&(""!==t?(y.text+="\n"+t,u[b].setAnnotations(u[b].getAnnotations())):y=!1),e}function k(){y=!1;var e=c;return c="",e}function T(){y=!1;var e=h;return h="","<pre><i>"+e+"</i></pre>"}for(var S=0;S<v.length;S++){var A=v[S];if(t)l+=_(L.sanitizeText(A),A)+"\n";else{var I=s.exec(A),B=s.test(A);if(null!==I!=B&&L.log("error"),i.test(A)){switch(a){case"comment":l+=k();break;case"case":l+=T()}w&&(l+="</div>"),l=(l+=function(e){y=!1,e=e.substr(1);null!==(t=r.exec(e))&&(e=e.substr(0,e.length-t[0].length));var t="";return n&&(t+='<a href="javascript:void(0)" onclick="VPLUtil.showHideDiv(this)">[+]</a>'),t=_(t+='<b class="ui-widget-header ui-corner-all">'+L.sanitizeText(e)+"</b><br>",e)}(A))+(n?'<div style="display:none">':"<div>"),w=!0,a=""}else a=B?("comment"==a&&(l+=k()),B=A.substr(I[0].length),I=void 0,I=L.sanitizeText(B),h+=_(I,B)+"\n","case"):("case"==a&&(l+=T()),I=void 0,I=L.sanitizeText(B=A),c+=_(I,B)+"<br>","comment")}}switch(a){case"comment":l+=k();break;case"case":l+=T()}return w&&(l+="</div>"),l},h=[],L.loadScript=function(e,t){var n,o;0==e.length?t():(n=e[0],void 0===h[n]?(e.shift(),h[n]=1,(o=document.createElement("script")).type="text/javascript",o.src=L.options.scriptPath+n,o.onload=function(){h[n]=2,L.loadScript(e,t)},document.head.appendChild(o)):2==h[n]?(e.shift(),L.loadScript(e,t)):(L.log("Error loading js "+n+" "+h[n]),setTimeout(function(){L.loadScript(e,t)},50)))},L.isScriptLoading=function(e){return void 0!==h[e]&&1==h[e]},L.isScriptLoaded=function(e){return void 0!==h[e]&&2==h[e]},L.adjustBlockly=function(e,t,n){for(var o=e.getAllBlocks(),r=2e4,i=-2e4,s=2e4,a=-2e4,l=0;l<o.length;l++)var c=o[l].getRelativeToSurfaceXY(),r=Math.min(r,c.y),i=Math.max(i,c.y),s=Math.min(s,c.x),a=Math.max(a,c.x);for(var o=e.getTopBlocks(),d=0;d<o.length;d++)o[d].moveBy(t-s,n-r);return i-r+100+n},v=[],m=[],y=[],k.prototype.highlightBlockly=function(o){L.loadScript(["../editor/blockly/blockly_compressed.js","../editor/blockly/msg/js/en.js","../editor/blockly/blocks_compressed.js"],function(){var e=p("#"+o),t=e.html(),t=(p("#"+o+"load").remove(),e.html(""),e.show(),t=p("<div />").html(t).text().replace(/\n/g,""),Blockly.Xml.textToDom(t)),n=(e.html("").height(300).width(e.parent().width()),Blockly.inject(o,{toolbox:"",readOnly:!0,media:"../editor/blockly/media/"})),t=(Blockly.Xml.domToWorkspace(t,n),L.adjustBlockly(n,10,10)),t=(e.height(t),e.width("100%"),Blockly.svgResize(n),Blockly.resizeSvgContents(n),e.html());n.dispose(),e.html(t)})},k.prototype.highlight=function(){var t=this,n=!1,o=this.files;for(let e=0;e<o.length;e++){var r=o[e];if(!L.isBinary(r.fileName)&&!L.isBlockly(r.fileName)){n=!0;break}}if(n&&"undefined"==typeof ace)L.loadScript(["../editor/ace9/ace.js"],function(){t.highlight()});else{var e=this.results,i=[],s=[];for(let e=0;e<o.length;e++){var a,l=o[e],c="code"+l.tagId;L.isBlockly(l.fileName)?t.highlightBlockly(c):(a=L.fileExtension(l.fileName),a=L.langType(a),p("#"+c).show(),p("#"+c+"load").remove(),(c=ace.edit(c)).setTheme("ace/theme/"+l.theme),c.getSession().setMode("ace/mode/"+a),c.renderer.setShowGutter(l.showln),c.setReadOnly(!0),c.setHighlightActiveLine(!1),c.setAutoScrollEditorIntoView(!0),c.setOption("maxLines",l.nl),c.getAnnotations=function(){return this.getSession().getAnnotations()},c.setAnnotations=function(e){return this.getSession().setAnnotations(e)},c.getTagId=function(){return this.vplTagId},c.vplTagId=l.tagId,i.push(c),s.push(l.fileName),y[l.tagId]=c)}for(var d=0;d<e.length;d++){var u=document.getElementById(e[d].tagId),f=u.textContent||u.innerText;u.innerHTML=L.processResult(f,s,i,e[d].noFormat,e[d].folding)}}},L.addResults=function(e,t,n){m.push({tagId:e,noFormat:t,folding:n})},L.syntaxHighlightFile=function(e,t,n,o,r){v.push({tagId:e,fileName:t,theme:n,showln:o,nl:r})},L.syntaxHighlight=function(){new k(v,m),v=[],m=[]},L.flEventHandler=function(e){var t=e.target.getAttribute("href").substring(1),e=e.target.getAttribute("data-line"),t=y[t];t.gotoLine(e,0),t.scrollToLine(e,!0)},L.setflEventHandler=function(){for(var e=document.getElementsByClassName("vpl_fl"),t=0;t<e.length;t++)e[t].onclick=L.flEventHandler},L.showHideDiv=function(e){for(var t=e,n=(n=(n=e).nextSibling?n:n.parentNode).nextSibling;"DIV"!=n.nodeName&&"PRE"!=n.nodeName;)if(!(n=n.nextSibling))return;t&&("[+]"==t.innerHTML?(n.savedDisplay?n.style.display=n.savedDisplay:n.style.display="",t.innerHTML="[-]"):(n.savedDisplay=n.style.display,n.style.display="none",t.innerHTML="[+]"))},L.options={scriptPath:""},void 0!==window.VPLDebugMode&&(b=window.VPLDebugMode),L.init=function(e){L.options={scriptPath:""},p.extend(L.options,e),void 0!==window.VPLDebugMode&&(b=window.VPLDebugMode),L.log(L.options)},window.VPLUtil=L});
//# sourceMappingURL=vplutil.min.js.map