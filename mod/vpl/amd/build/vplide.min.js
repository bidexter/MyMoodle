function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}
define(["jquery","jqueryui","mod_vpl/vplutil","mod_vpl/vplidefile","mod_vpl/vplidebutton","mod_vpl/vplterminal","mod_vpl/vplvnc"],function(fe,e,pe,he,ge,ve,me){var _e,i=function(e,u){var f,p,n,h=this,g=u.minfiles||0,v=u.maxfiles||0,m=u.restrictededitor||u.example,P=u.example,O=u.isTeacher,R=!1,W=pe.scrollBarWidth(),_=pe.str,t=fe("#"+e);if(fe("head").append('<meta name="viewport" content="initial-scale=1">').append('<meta name="viewport" width="device-width">').append('<link rel="stylesheet" href="../editor/VPLIDE.css"/>'),"object"!=typeof t)throw new Error("VPL: constructor tag_id not found");var E={new:!0,rename:!0,delete:!0,save:!0,run:!0,edit:!0,debug:!0,evaluate:!0,import:!0,resetfiles:!0,sort:!0,multidelete:!0,acetheme:!0,console:!0,comments:!0},a=(void 0===u.loadajaxurl&&(u.loadajaxurl=u.ajaxurl),e=g<v,u.new=e,u.rename=e,u.delete=e,u.comments=u.comments&&!u.example,u.acetheme=!0,u.sort=2<=v-g,u.multidelete=u.sort,u.import=!m,function(e){return!E[e]||u[e]});function D(e){e.originalEvent.dataTransfer.dropEffect=m?"none":"copy",e.preventDefault()}function j(e){var t;return m?e.stopImmediatePropagation():0<(t=e.originalEvent.dataTransfer).files.length&&(pe.readSelectedFiles(t.files,function(e){return f.addFile(e,!0,p,C)},function(){f.fileListVisibleIfNeeded()}),e.stopImmediatePropagation()),!1}function B(e){return!m||(e.stopPropagation(),!1)}u.console=a("run")||a("debug"),void 0===u.fontSize&&(u.fontSize=12),u.fontSize=parseInt(u.fontSize),t.on("drop",j),t.on("dragover",D);var l=fe("#vpl_menu"),b=new ge(l,a),q=fe("#vpl_tr"),w=fe("#vpl_filelist"),o=fe("#vpl_filelist_header"),F=fe("#vpl_filelist_content"),s=fe("#vpl_tabs_ul"),r=fe("#vpl_tabs"),T=fe("#vpl_results"),y=fe("#vpl_results_accordion");w.vplMinWidth=80,T.vplMinWidth=100,this.updateEvaluationNumber=function(e){var t;void 0!==e.nevaluations&&(t=e.nevaluations,void 0!==e.reductionbyevaluation&&""<e.reductionbyevaluation&&0!=e.reductionbyevaluation&&(t=(t=0!=e.freeevaluations?t+"/"+e.freeevaluations:t)+" -"+e.reductionbyevaluation),b.setExtracontent("evaluate",t))},this.lastResult=null,this.getTerminal=function(){return ee},this.setResultGrade=function(e,t){var i="vpl_ide_accordion_t_grade",n="vpl_ide_accordion_c_grade";return 0==y.find("."+n).length&&(y.append('<div class="'+i+'"></div>'),y.append('<div class="'+n+'"></div>')),void 0===t?0<y.find("h4."+i).length:(n=y.find("."+i),""<e?(n.replaceWith('<h4 class="'+i+'">'+e+"</h4>"),!0):(n.replaceWith('<div class="'+i+'"></div>'),!1))},this.setResultTab=function(e,t,i){var n,l,o="vpl_ide_accordion_t_"+e,a="vpl_ide_accordion_c_"+e;return 0==y.find("."+a).length&&(y.append('<div class="'+o+'"></div>'),y.append('<div class="'+a+'"></div>')),void 0===i?0<y.find("h4."+o).length:(i=y.find("."+o),n=y.find("."+a),(l=fe("<div>"+t+"</div>")).find("h4").replaceWith(function(){return fe("<h5>").append(fe(this).contents())}),n.html()==l.html()?""<t:""<t?(i.replaceWith('<h4 class="'+o+'">'+_(e)+"</h4>"),n.replaceWith('<div class="ui-widget '+a+'">'+l.html()+"</div>"),!0):(i.replaceWith('<div class="'+o+'"></div>'),n.replaceWith('<div class="'+a+'"></div>'),!1))},this.setResult=function(e,t){h.updateEvaluationNumber(e);for(var i=f.getFiles(),n=[],l=0;l<i.length;l++)n[l]=i[l].getFileName(),i[l].clearAnnotations();var o,a=pe.sanitizeText(e.grade),a=h.setResultGrade(a,e.grade),s=a,r=h.setResultTab("variables",e.variables,e.variables);if(s=s||r,o=pe.processResult(e.compilation,n,i,!0,!1),r=h.setResultTab("compilation",o,e.compilation),s=s||r,o=pe.processResult(e.evaluation,n,i,!1,!1),r=h.setResultTab("comments",o,e.evaluation),s=s||r,o=pe.sanitizeText(e.execution),r=h.setResultTab("execution",o,e.execution),s=s||r,(r=h.setResultTab("description",window.VPLDescription,window.VPLDescription))&&"object"==typeof MathJax&&(o=y.find(".vpl_ide_accordion_c_description")[0],MathJax.Hub.Queue(["Typeset",MathJax.Hub,o])),s||r){for(T.show(),T.vplVisible=!0,y.accordion("refresh"),y.accordion("option","active",a?1:0),l=0;l<i.length;l++)for(var d=i[l].getAnnotations(),c=0;c<d.length;c++)if(t||"error"==d[c].type){f.gotoFile(l,d[c].row+1);break}fe("#vpl_ide_rightpanel").show()}else T.hide(),T.vplVisible=!1,fe("#vpl_ide_rightpanel").hide();pe.delay("autoResizeTab",A)},y.accordion({heightStyle:"fill",header:"h4",animate:!1,beforeActivate:function(e,t){return!("newHeader"in t&&t.newHeader.hasClass("vpl_ide_accordion_t_grade"))}}),T.width(2*T.vplMinWidth),y.on("click","a",function(e){f.gotoFileLink(e.currentTarget)&&e.preventDefault()}),T.vplVisible=!1,T.hide(),w.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all"),o.text(_("filelist")),o.html(pe.iconFolder()+o.html()),o.addClass("ui-widget-header ui-button-text-only ui-corner-all"),F.addClass("ui-widget ui-corner-all"),w.width(2*w.vplMinWidth),w.on("click","a",function(e){e.preventDefault(),f.gotoFileLink(e.currentTarget)}),w.vplVisible=!1,w.hide();var d=!1;function c(){return d=!1===d?(r.outerWidth(!0)-r.width())/2:d}function K(e,t){var i,n=t.position.left-t.originalPosition.left;0!=n?(i=r.width()+w.width()-w.vplMinWidth,r.resizable("option","maxWidth",i),w.width(w.vplOriginalWidth+n)):(i=r.width()+T.width()-T.vplMinWidth,r.resizable("option","maxWidth",i),n=t.size.width-t.originalSize.width,T.width(T.vplOriginalWidth-n)),f.currentFile("adjustSize")}var x={containment:"parent",resize:K,start:function(){fe(window).off("resize",A),r.resizable("option","minWidth",100),T.vplVisible&&(T.vplOriginalWidth=T.width()),w.vplVisible&&(w.vplOriginalWidth=w.width())},stop:function(e,t){K(0,t),r.resizable("option","maxWidth",1e5),r.resizable("option","minWidth",0),A(),fe(window).on("resize",A)},handles:""};function L(){f.currentFile("focus")}r.resizable(x);var M=function(e){var t,i=r.width(),n=0,l=(s.width(1e5),s.children("li:visible").last());l.length&&(n=(t=s.parent().scrollLeft())+l.position().left+l.width()+d,s.width(n),l=f.currentFile())&&e&&(t=t+(e=fe(l.getTabNameId())).position().left,(t-=(i-e.outerWidth())/2)<0&&(t=0),s.parent().finish().animate({scrollLeft:t},"slow")),n<i&&s.width("")},A=function(){var e,t=r.width(),i=l.width(),n=!1;e=0,e=(e+=w.vplVisible?1:0)+(T.vplVisible?2:0),r.resizable("destroy"),x.handles=["e","w","e","e, w"][e],x.disable=0==e,r.resizable(x),q.width(l.outerWidth()),w.vplVisible?(t+=e=w.outerWidth()+d,100<=e?(i-=e,r.css("left",e)):n=!0):r.css("left",0),(n=T.vplVisible&&(t+=e=T.outerWidth()+d,(i-=e)<100)?!0:n)?(e=l.width()/t,n=0,w.vplVisible&&(n=w.width()*e,w.width(n-d),n+=d,r.css("left",n)),r.width(r.width()*e),T.vplVisible&&T.width(l.width()-(n+r.width()+d))):r.width(i),M(!0),t=fe(window).outerHeight(),t-=l.offset().top+l.height()+(R?c():20),q.height(t=t<150?150:t),t-=3*c(),r.height(t),T.vplVisible&&(T.height(t+c()),y.accordion("refresh")),w.vplVisible&&(F.height(t-(o.outerHeight()+c())),w.height(t)),f.currentFile("adjustSize")},i=fe.extend({},{close:L},pe.dialogbaseOptions);function z(e,t){pe.showMessage(e,fe.extend({},i,t))}var C=function(e){return pe.showErrorMessage(e,{close:L})},V=fe("#vpl_ide_dialog_new");function U(e){if("click"!=e.type&&("keypress"!=e.type||13!=e.keyCode))return!0;V.dialog("close");e={name:fe("#vpl_ide_input_newfilename").val(),contents:"",encoding:0},e=f.addFile(e,!1,p,C);return!!e&&(f.open(e),r.tabs("option","active",f.getTabPos(e)),e.focus(),!0)}var e={},k=(e[_("ok")]=U,e[_("cancel")]=function(){fe(this).dialog("close")},V.find("input").on("keypress",U),V.dialog(fe.extend({},i,{title:_("create_new_file"),buttons:e})),pe.setDialogTitleIcon(V,"new"),fe("#vpl_ide_dialog_rename"));function G(e){("click"==e.type||"keypress"==e.type&&13==e.keyCode)&&(k.dialog("close"),f.renameFile(f.currentFile("getFileName"),fe("#vpl_ide_input_renamefilename").val(),C),e.preventDefault())}k.find("input").on("keypress",G),e[_("ok")]=G,k.dialog(fe.extend({},i,{open:function(){fe("#vpl_ide_input_renamefilename").val(f.currentFile("getFileName"))},title:_("rename_file"),buttons:e})),pe.setDialogTitleIcon(k,"rename"),e[_("ok")]=function(){fe(this).dialog("close")};var J=fe("#vpl_ide_dialog_comments"),I=(J.dialog(fe.extend({},i,{title:_("comments"),width:"40em",buttons:e})),pe.setDialogTitleIcon(J,"comments"),fe("#vpl_ide_input_comments").width("30em"),fe("#vpl_ide_dialog_about")),e={},X=(e[_("ok")]=function(){fe(this).dialog("close")},fe("#vpl_ide_dialog_shortcuts")),Y=(X.dialog(fe.extend({},i,{open:function(){var e=b.getShortcuts(f.currentFile("getEditor"));fe("#vpl_ide_dialog_shortcuts").html(e)},title:_("shortcuts"),width:400,height:300,buttons:e})),X.dialog("option","height",300),pe.setDialogTitleIcon(X,"shortcuts"),e[_("shortcuts")]=function(){fe(this).dialog("close"),X.dialog("open")},I.dialog(fe.extend({},i,{open:function(){var e=b.getShortcuts(f.currentFile("getEditor"));I.next().find("button").filter(function(){return fe(this).text()==_("shortcuts")}).button(""!=e?"enable":"disable")},title:_("about"),width:400,height:300,buttons:e})),I.dialog("option","height",300),pe.setDialogTitleIcon(I,"about"),fe("#vpl_ide_dialog_sort")),e={},Q=(e[_("ok")]=function(){var t=f.getFiles(),i=/[^\d]*/,n=[],e=0,l=fe("#vpl_sort_list li");if(l.length==t.length){for(l.each(function(){var e=parseInt(this.id.replace(i,""));n.push(t[e])}),e=0;e<l.length;e++)t[e]=n[e];f.setModified(),fe(this).dialog("close")}},e[_("cancel")]=function(){fe(this).dialog("close")},Y.dialog(fe.extend({},i,{title:_("sort"),buttons:e,open:function(){for(var e=fe("#vpl_sort_list"),t=(e.html(""),f.getFiles()),i=0;i<t.length;i++){var n=fe('<li id="vpl_fsort_'+i+'"class="ui-widget-content"></li>');i<g&&n.addClass("ui-state-disabled"),n.text(i+1+"-"+t[i].getFileName()),e.append(n)}e.sortable({items:"li:not(.ui-state-disabled)",placeholder:"ui-state-highlight",start:function(e,t){t.item.addClass("ui-state-highlight")},stop:function(e,t){t.item.removeClass("ui-state-highlight")}}),e.disableSelection()},maxHeight:400})),pe.setDialogTitleIcon(Y,"sort"),fe("#vpl_ide_dialog_multidelete")),e={},Z=(e[_("selectall")]=function(){fe(this).find("input").prop("checked",!0)},e[_("deselectall")]=function(){fe(this).find("input").prop("checked",!1)},e[_("deleteselected")]=function(){var t=f.getFiles(),i=[];fe("#vpl_multidelete_list label").each(function(){var e=fe(this);e.find("input").prop("checked")&&(e=e.data("fileid"),i.push(t[e].getFileName()))});for(var e=0;e<i.length;e++)f.deleteFile(i[e],C);pe.delay("updateMenu",p),pe.delay("updateFileList",f.updateFileList),fe(this).dialog("close")},e[_("cancel")]=function(){fe(this).dialog("close")},Q.dialog(fe.extend({},i,{title:_("multidelete"),buttons:e,open:function(){for(var e=fe("#vpl_multidelete_list"),t=(e.html(""),f.getFiles()),i=g;i<t.length;i++){var n=pe.sanitizeText(t[i].getFileName()),n=fe('<label><input type="checkbox"> '+n+"</label>");n.data("fileid",i),e.append(n),e.append("<br>")}e.find("label").button()},maxHeight:400,maxWidth:400})),pe.setDialogTitleIcon(Q,"multidelete"),fe("#vpl_ide_dialog_fontsize")),N=fe("#vpl_ide_dialog_fontsize .vpl_fontsize_slider"),e={},$=(e[_("ok")]=function(){var e=N.slider("value");f.setFontSize(e),fe(this).dialog("close"),fe.ajax({async:!0,type:"POST",url:"../editor/userpreferences.json.php",data:JSON.stringify({fontSize:e}),contentType:"application/json; charset=utf-8",dataType:"json"})},e[_("cancel")]=function(){f.setFontSize(N.data("vpl_fontsize")),fe(this).dialog("close")},e[_("reset")]=function(){N.slider("value",12)},Z.dialog(fe.extend({},i,{title:_("fontsize"),buttons:e,open:function(){N.data("vpl_fontsize",f.getFontSize()),N.slider("value",f.getFontSize())}})),N.slider({min:1,max:48,change:function(){var e=N.slider("value");f.setFontSize(e),Z.find(".vpl_fontsize_slider_value").text(e)}}),pe.setDialogTitleIcon(Z,"fontsize"),fe("#vpl_ide_dialog_acetheme")),S=fe("#vpl_ide_dialog_acetheme select"),e={},ee=(e[_("ok")]=function(){f.setTheme(S.val()),fe(this).dialog("close"),pe.setUserPreferences({aceTheme:S.val()})},e[_("cancel")]=function(){f.setTheme(S.data("acetheme")),fe(this).dialog("close")},e[_("reset")]=function(){S.val(S.data("acetheme")),f.setTheme(S.val())},$.dialog(fe.extend({},i,{title:_("theme"),buttons:e,modal:!1,open:function(){S.data("acetheme",f.getTheme()),S.val(f.getTheme())}})),S.on("change",function(){f.setTheme(S.val())}),pe.setDialogTitleIcon($,"theme"),new ve("vpl_dialog_terminal","vpl_terminal",_)),te=new me("vpl_dialog_vnc",_),H=ee,ie=fe("#vpl_ide_input_file");function ne(){pe.requestAction("resetfiles","",{},u.ajaxurl).done(function(e){var t,i=e.files;for(t in i)i.hasOwnProperty(t)&&f.addFile(i[t],!0,pe.doNothing,C);f.fileListVisibleIfNeeded(),pe.delay("updateMenu",p)}).fail(C)}function le(t,i,e){e=e||{},H.isConnected()||pe.requestAction(t,"",e,u.ajaxurl).done(function(e){pe.webSocketMonitor(e,t,i,n)}).fail(C)}function oe(){le("run","running",{XGEOMETRY:te.getCanvasSize()})}function ae(){le("debug","debugging",{XGEOMETRY:te.getCanvasSize()})}function se(){le("evaluate","evaluating")}ie.on("change",function(){pe.readSelectedFiles(this.files,function(e){return f.addFile(e,!0,p,C)},function(){f.fileListVisibleIfNeeded()})}),b.add({name:"filelist",originalAction:function(){f.fileListVisible(!f.isFileListVisible()),pe.delay("updateMenu",p),pe.delay("autoResizeTab",A),pe.delay("updateFileList",f.updateFileList)},bindKey:{win:"Ctrl-L",mac:"Ctrl-L"}}),b.add({name:"new",originalAction:function(){f.length()<v&&V.dialog("open")},bindKey:{win:"Alt-N",mac:"Option-N"}}),b.add({name:"rename",originalAction:function(){var e=f.currentFile();e&&f.getFilePosById(e.getId())>=g&&k.dialog("open")},bindKey:{win:"Ctrl-R",mac:"Ctrl-R"}}),b.add({name:"delete",originalAction:function(){var e,t=f.currentFile();t&&(e=t.getFileName(),z(_("delete_file_fq",e),{ok:function(){f.deleteFile(e,C)},title:_("delete_file_q"),icon:"trash"}))},bindKey:{win:"Ctrl-D",mac:"Ctrl-D"}}),b.add({name:"close",originalAction:function(){var e=f.currentFile();e&&f.close(e)},bindKey:{win:"Alt-W",mac:"Option-W"}}),b.add({name:"import",originalAction:function(){ie.val(""),ie.trigger("click")},bindKey:{win:"Ctrl-I",mac:"Ctrl-I"}}),b.add({name:"sort",originalAction:function(){Y.dialog("open")},bindKey:{win:"Ctrl-O",mac:"Ctrl-O"}}),b.add({name:"multidelete",originalAction:function(){Q.dialog("open")}}),b.add({name:"fontsize",originalAction:function(){Z.dialog("open")}}),b.add({name:"theme",originalAction:function(){$.dialog("open")}}),b.add({name:"print",originalAction:function(){window.print()},bindKey:{win:"Alt-P",mac:"Command-P"}}),b.add({name:"undo",originalAction:function(){f.currentFile("undo")}}),b.add({name:"redo",originalAction:function(){f.currentFile("redo")}}),b.add({name:"select_all",editorName:"selectall",originalAction:function(){f.currentFile("selectAll")}}),b.add({name:"find",originalAction:function(){f.currentFile("find")}}),b.add({name:"find_replace",editorName:"replace",originalAction:function(){f.currentFile("replace")}}),b.add({name:"next",editorName:"findnext",originalAction:function(){f.currentFile("next")}}),b.add({name:"fullscreen",originalAction:function(){var e="header, nav, footer, aside, .dropdown, #page-header, div.navbar, #nav-drawer";e+=", div.tabtree, #dock, .breadcrumb-nav, .moodle-actionmenu",R=R?(t.removeClass("vpl_ide_root_fullscreen"),fe("body").removeClass("vpl_body_fullscreen"),b.setText("fullscreen","fullscreen"),fe(e).show(),!1):(fe("body").addClass("vpl_body_fullscreen").scrollTop(0),fe(e).hide(),t.addClass("vpl_ide_root_fullscreen"),b.setText("fullscreen","regularscreen"),!0),L(),setTimeout(A,10)},bindKey:{win:"Alt-F",mac:"Ctrl-F"}}),b.add({name:"download",originalAction:function(){window.location=u.download}}),b.add({name:"resetfiles",originalAction:function(){z(_("sureresetfiles"),{title:_("resetfiles"),ok:ne,icon:"resetfiles"})}}),b.add({name:"save",originalAction:function(){var i={files:f.getFilesToSave(),comments:fe("#vpl_ide_input_comments").val(),version:f.getVersion()};JSON.stringify(i).length>u.postMaxSize?C(_("maxpostsizeexceeded")):function t(){pe.requestAction("save","saving",i,u.ajaxurl).done(function(e){e.requestsconfirmation?z(e.question,{title:_("saving"),icon:"alert",yes:function(){i.version=e.version,t()}}):(f.resetModified(),f.setVersion(e.version),b.setTimeLeft(e),pe.delay("updateMenu",p),pe.monitorRunning()&&(i.processid=pe.getProcessId(),pe.requestAction("update","updating",i,u.ajaxurl)))}).fail(C)}()},bindKey:{win:"Ctrl-S",mac:"Command-S"}}),b.add({name:"run",originalAction:function(){n.setLastAction(oe),oe()},bindKey:{win:"Ctrl-F11",mac:"Command-U"}}),b.add({name:"debug",originalAction:function(){n.setLastAction(ae),ae()},bindKey:{win:"Alt-F11",mac:"Option-U"}}),b.add({name:"evaluate",originalAction:function(){n.setLastAction(se),se()},bindKey:{win:"Shift-F11",mac:"Command-Option-U"}}),b.add({name:"comments",originalAction:function(){J.dialog("open")}}),b.add({name:"console",originalAction:function(){H.isOpen()?H.close():H.show()}}),b.add({name:"user"}),b.add({name:"about",originalAction:function(){I.dialog("open")}}),b.add({name:"timeleft",originalAction:function(){b.toggleTimeLeft()}}),b.add({name:"more",originalAction:function(){var e=fe("#vpl_ide_menuextra");e.is(":visible")?(b.setText("more","more",pe.str("more")),e.hide()):(b.setText("more","less",pe.str("less")),e.show()),pe.delay("updateMenu",p),pe.delay("autoResizeTab",A)}}),b.add({name:"rts",icon:"rts-off",originalAction:function(){var e=fe("#vpl_ide_rts_tag");e.is(":visible")?(b.setText("rts","rts-off",pe.str("go_rts_on")),u.username&&fe("#vpl_ide_user").hide(),e.hide()):(b.setText("rts","rts-on",pe.str("go_rts_off")),u.username&&fe("#vpl_ide_user").show(),e.show()),pe.delay("updateMenu",p),pe.delay("autoResizeTab",A)}}),b.add({name:"rightpanel",icon:"close-rightpanel",originalAction:function(){T.vplVisible?(T.hide(),T.vplVisible=!1,b.setText("rightpanel","open-rightpanel",pe.str("rightpanel"))):(b.setText("rightpanel","close-rightpanel",pe.str("rightpanel")),T.show(),T.vplVisible=!0),pe.delay("autoResizeTab",A)},bindKey:{win:"Ctrl-M",mac:"Ctrl-M"}});q.append('<span style="position:absolute;right:0;top:60px;z-index:100;margin:3px">'+b.getHTML("rightpanel")+"</span>");for(var e=fe("#vpl_ide_rightpanel"),e=(b.setText("rightpanel","close-rightpanel",pe.str("rightpanel")),e.button(),e.css("padding","0"),fe("#vpl_ide_rightpanel.ui-button-text").css("padding","0"),e.on("click",function(){b.launchAction("rightpanel")}),e.hide(),l.addClass("ui-widget-header ui-corner-all"),""),re=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e+=b.getHTML("more"))+b.getHTML("save")+"<span id='vpl_ide_mexecution'>")+b.getHTML("run"))+b.getHTML("debug"))+b.getHTML("evaluate"))+b.getHTML("comments"))+b.getHTML("console")+"</span> ")+"<span id='vpl_ide_menuextra'>"+"<span id='vpl_ide_file'>")+b.getHTML("filelist"))+b.getHTML("new"))+b.getHTML("rename"))+b.getHTML("delete"))+b.getHTML("import"))+b.getHTML("download"))+b.getHTML("resetfiles"))+b.getHTML("sort"))+b.getHTML("multidelete"))+b.getHTML("fontsize"))+b.getHTML("theme"))+"</span> "+"<span id='vpl_ide_edit'>")+b.getHTML("undo"))+b.getHTML("redo"))+b.getHTML("select_all"))+b.getHTML("find"))+b.getHTML("find_replace"))+b.getHTML("next"))+"</span> "+"</span> ")+(b.getHTML("fullscreen")+" "))+(b.getHTML("about")+" "))+b.getHTML("rts")+"<span id='vpl_ide_rts_tag'>")+(b.getHTML("user")+" ")+"</span> ")+b.getHTML("timeleft"),l.append(e+='<div class="clearfix"></div>'),fe("#vpl_ide_more").button(),fe("#vpl_ide_save").button(),fe("#vpl_ide_menuextra").hide(),fe("#vpl_ide_file").controlgroup(),fe("#vpl_ide_edit").controlgroup(),fe("#vpl_ide_mexecution").controlgroup(),fe("#vpl_ide_fullscreen").button(),fe("#vpl_ide_acetheme").button(),fe("#vpl_ide_about").button(),fe("#vpl_ide_rts").button(),fe("#vpl_ide_rts_tag").hide(),fe("#vpl_ide_user").button().css("float","right"),fe("#vpl_ide_timeleft").button().css("float","right").hide(),fe("#vpl_menu .ui-button").css("padding","6px"),fe("#vpl_menu .ui-button-text").css("padding","0"),["filelist","more","fullscreen","about","rts","resetfiles","download","comments","console","import","fontsize","timeleft"]),de=0;de<re.length;de++)b.enable(re[de],!0);b.setExtracontent("user",u.username),b.setTimeLeft(u),n={open:p=function(){var e,t,i=f.currentFile(),n=f.length(),l=(n?r.show():r.hide(),f.isFileListVisible()?b.setText("filelist","filelistclose",pe.str("filelist")):b.setText("filelist","filelist",pe.str("filelist")),f.isModified()),o=(b.enable("save",l),pe.monitorRunning());if(o?b.setText("run","running"):b.setText("run","run"),b.enable("run",!o&&(!l||u.example)&&a("run")),b.enable("debug",!o&&(!l||u.example)&&a("debug")),b.enable("evaluate",!o&&(!l||u.example)&&a("evaluate")),b.enable("download",!l),b.enable("new",n<v),b.enable("sort",1<n-g),b.enable("multidelete",1<n-g),b.enable("theme",!0),i&&0!==n){o=f.getFilePosById(i.getId());b.enable("rename",g<=o&&0!==n),b.enable("delete",g<=o&&0!==n),b.enable("undo",i.hasUndo()),b.enable("redo",i.hasRedo()),b.enable("select_all",i.hasSelectAll()),b.enable("find",i.hasFind()),b.enable("find_replace",i.hasFindReplace()),b.enable("next",i.hasNext()),pe.delay("updateFileList",f.updateFileList)}else for(t=["rename","delete","undo","redo","select_all","find","find_replace","next"],e=0;e<t.length;e++)b.enable(t[e],!1)},close:p,getConsole:function(){return H},setResult:h.setResult,ajaxurl:u.ajaxurl,run:function(e,t,i){var n,l,o=/^([^:]*):?(.*)/i.exec(e),a=o[1];"terminal"==a||"webterminal"==a?(H&&H.isOpen()&&H.close(),(H=ee).connect(t.executionURL,function(){i.close(),L()}),"webterminal"==a&&(n=(t.secure?"https":"http")+"://"+t.server+":"+t.portToUse,n+="/favicon.ico",(l=fe("<img>")).attr("src",n),l.attr("style","display:none"),fe("body").append(l))):"vnc"==a?(H&&H.isOpen()&&H.close(),(H=te).connect(t.secure,t.server,t.portToUse,t.VNCpassword,t.executionPath,function(){i.close(),L()})):"browser"==a?(n=(t.secure?"https":"http")+"://"+t.server+":"+t.portToUse+"/",n+=o[2]+"/httpPassthrough",O&&(n+="?private"),l='<a href="'+n+'" target="_blank">',z(l+=pe.str("open")+"</a>",{width:200,icon:"run",title:pe.str("run")})):pe.log("Type of run error "+e,!0)},lastAction:!1,getLastAction:function(){var e=this.lastAction;return this.lastAction=!1,e},setLastAction:function(e){this.lastAction=e}},r.on("tabsactivate",function(){f.currentFile("focus"),pe.delay("updateMenu",p),pe.delay("autoResizeTab",A)});var ce,e=fe(window);function ue(){var e=l.width();ce!=e&&(ce=e,A())}e.on("resize",A),u.example||e.on("beforeunload",function(){if(f.isModified())return _("changesNotSaved")}),f=new function(){var t,i=fe("#vpl_tabs_ul"),n=(fe("#vpl_tabs").tabs(),fe("#vpl_tabs").tabs("widget")),r=[],l=[],o=!0,a=this;function s(e){for(var t=e.toLowerCase()+"/",i=0;i<r.length;i++){var n=r[i].getFileName().toLowerCase()+"/";if(0===n.indexOf(t)||0===t.indexOf(n))return 1}}function d(e,t){if(!pe.isBlockly(e)&&pe.isBlockly(t))for(var i=0;i<r.length;i++)if(pe.isBlockly(r[i].getFileName()))return 1}a.setVersion=function(e){t=e},a.getVersion=function(){return t},this.updateFileList=function(){a.generateFileList()},this.fileNameExists=function(e){for(var t=e.toLowerCase(),i=0;i<r.length;i++)if(r[i].getFileName().toLowerCase()==t)return i;return-1},this.restrictedPaste=B,this.dropHandler=j,this.dragoverHandler=D,this.readOnly=P,this.restrictedEdit=m,this.adjustTabsTitles=M,this.minNumberOfFiles=g,this.scrollBarWidth=W;var c="";this.setClipboard=function(e){c=e},this.getClipboard=function(){return c},this.getTabPos=function(e){for(var t=0;t<l.length;t++)if(l[t]==e)return t;return l.length},this.getTheme=function(){return u.theme},this.setTheme=function(e){u.theme=e;for(var t=0;t<r.length;t++)r[t].setTheme(e)},this.addTab=function(e){i.append('<li id="vpl_tab_name'+e+'">'+('<a href="#vpl_file'+e+'"></a>')+"</li>"),n.append('<div id="vpl_file'+e+'" class="vpl_ide_file"></div>')},this.removeTab=function(e){i.find("#vpl_tab_name"+e).remove(),n.find("#vpl_file"+e).remove()},this.open=function(e){var t,e="object"==typeof e?e:r[e];e.isOpen()||(t=e.getId(),a.addTab(t),l.push(e),b.setGetkeys(e.open()),n.tabs("refresh"),M(!1),pe.delay("updateFileList",a.updateFileList),pe.delay("updateMenu",p))},this.close=function(e){var t,i;e.isOpen()&&(i=e.getId(),e.close(),a.removeTab(i),i=a.getTabPos(e),l.splice(i,1),n.tabs("refresh"),M(!1),a.fileListVisible(!0),pe.delay("updateFileList",a.updateFileList),pe.delay("adjustTabsTitles",M,!1),i<l.length?(t=a.getFilePosById(l[i].getId()),a.gotoFile(t,"c")):0<i&&(t=a.getFilePosById(l[i-1].getId()),a.gotoFile(t,"c")))},this.isClosed=function(e){return!r[e].isOpen()},this.fileListVisible=function(e){e!==w.vplVisible&&(e?pe.delay("fileListVisible",function(){w.vplVisible=!0,a.updateFileList(),w.show(),A()}):pe.delay("fileListVisible",function(){w.vplVisible=!1,w.hide(),A()}))},this.isFileListVisible=function(){return w.vplVisible},this.fileListVisibleIfNeeded=function(){if(!this.isFileListVisible())for(var e=0;e<r.length;e++)if(!r[e].isOpen())return void this.fileListVisible(!0)},this.setFontSize=function(e){u.fontSize=e;for(var t=0;t<r.length;t++)r[t].setFontSize(e);ee.setFontSize(e)},this.getFontSize=function(){return u.fontSize},this.addFile=function(e,t,i,n){if("string"!=typeof e.name||!pe.validPath(e.name))return n(_("incorrect_file_name")+" ("+e.name+")"),!1;!0!==t&&(t=!1);var l=this.fileNameExists(e.name);return-1!=l?t?(r[l].setContent(e.contents),a.setModified(),i(),pe.delay("updateFileList",a.updateFileList),e):(n(_("filenotadded",e.name)),!1):s(e.name)||d("",e.name)?(n(_("filenotadded",e.name)),!1):r.length>=v?(n(_("maxfilesexceeded")+" ("+v+")"),!1):(t=pe.getUniqueId(),l=new he(t,e.name,e.contents,this,_e),1==e.encoding?l.extendToBinary():pe.isBlockly(e.name)?l.extendToBlockly():l.extendToCodeEditor(),l.setFileName(e.name),r.push(l),a.setModified(),5<r.length&&a.fileListVisible(!0),i(),l)},this.renameFile=function(t,i,n){var e,l=this.fileNameExists(t);try{if(-1==l)throw new Error("Internal error: File name not found");if(l<g)throw new Error("Internal error: Renaming requested filename");if(r[l].getFileName()==i)return!0;if(!pe.validPath(i)||s(i)||d(t,i))throw _("incorrect_file_name");if(pe.isBinary(t)&&pe.fileExtension(t)!=pe.fileExtension(i))throw _("incorrect_file_name");if(pe.isBlockly(t)!=pe.isBlockly(i))return""<r[l].getContent()?z(_("delete_file_fq",t),{ok:function(){var e={name:i,contents:"",encoding:0};f.deleteFile(t,n),f.addFile(e,!1,p,C)&&f.gotoFileName(i)}}):(e={name:i,contents:"",encoding:0},f.deleteFile(t,n),f.addFile(e,!1,p,n)&&f.gotoFileName(i)),!0;r[l].setFileName(i)}catch(e){return n(_("filenotrenamed",i)+": "+e),!1}return a.setModified(),M(!1),pe.delay("updateFileList",a.updateFileList),!0},this.deleteFile=function(e,t){var i=this.fileNameExists(e);return-1==i||i<g?(t(_("filenotdeleted",e)),!1):(a.setModified(),a.close(r[i]),r.splice(i,1),pe.delay("updateFileList",a.updateFileList),!0)},this.currentFile=function(){var e=n.tabs("option","active");if(e in l){e=l[e];if(0===arguments.length)return e;var t,i=arguments[0];if("function"==typeof e[i])return i=e[i],(t=Array.prototype.slice(arguments)).shift(),i.apply(e,t)}return!1},this.currentPos=function(){return n.tabs("option","active")},this.getFileTab=function(e){for(var t=0;t<l.length;t++)if(l[t].getId()==e)return t;return-1},this.getFilePosById=function(e){for(var t=0;t<r.length;t++)if(r[t].getId()==e)return t;return-1},this.gotoFile=function(e,t){e=r[e];a.open(e),n.tabs("option","active",a.getFileTab(e.getId())),"c"!==t&&e.gotoLine(parseInt(t,10)),e.focus()},this.gotoFileLink=function(e){var e=fe(e),t=e.data("file"),i=-1;return 0<=(i=""<t?this.fileNameExists(t):a.getFilePosById(e.data("fileid")))&&(t=e.data("line"),a.gotoFile(i,t=void 0===t?"c":t),!0)},this.gotoFileName=function(e,t){e=this.fileNameExists(e);return 0<=e&&(a.gotoFile(e,t=void 0===t?"c":t),!0)},this.getFilesToSave=function(){for(var e=[],t=0;t<r.length;t++){var i={};i.name=r[t].getFileName(),i.contents=r[t].getContent(),i.encoding=r[t].isBinary()?1:0,e.push(i)}return e},this.resetModified=function(){o=!1;for(var e=0;e<r.length;e++)r[e].resetModified();pe.delay("updateMenu",p),pe.delay("updateFileList",a.updateFileList)},this.setModified=function(){o=!0,pe.delay("updateFileList",a.updateFileList),pe.delay("updateMenu",p)},this.isModified=function(){return o},this.length=function(){return r.length},this.clearAnnotations=function(){for(var e=0;e<r.length;e++)r[e].clearAnnotations()},this.getFile=function(e){return r[e]},this.getFiles=function(){return r},this.getDirectoryStructure=function(){var e,t={isDir:!0,content:{}};for(e in r)if(r.hasOwnProperty(e)){n=i=s=a=o=l=void 0;var i,n,l=e,o=r[l],a=o.getFileName().split("/"),s=t;for(i in a)a.hasOwnProperty(i)&&(n=a[i],i==a.length-1?s.content[n]={isDir:!1,content:o,pos:l}:(s.content[n]||(s.content[n]={isDir:!0,content:{}}),s=s.content[n]))}return t},this.generateFileList=function(){if(a.isFileListVisible()){var r='<span class="vpl_ide_dirindent"></span>',e=[],t="";!function e(t,i,n){for(var l in t.content){var o,a,s;t.content.hasOwnProperty(l)&&((o=t.content[l]).isDir?(n.push(i+pe.iconFolder()+pe.sanitizeText(l)),e(o,i+r,n)):(a=o.content,l=pe.sanitizeText(l),s=pe.sanitizeText(a.getFileName()),a.isOpen()&&(l="<b>"+l+"</b>"),s='<a href="#" data-fileid="'+a.getId()+'" title="'+s+'">'+l+"</a>",a.isModified()&&(s=pe.iconModified()+s),o.pos<g&&(s+=pe.iconRequired()),n.push(i+s)))}}(a.getDirectoryStructure(),"",e);for(var i=0;i<e.length;i++)t+=e[i]+"<br>";F.html("<div>"+t+"</div>")}},i.on("click","span.vpl_ide_closeicon",function(){f.close(f.currentFile())}),i.on("dblclick","span.vpl_ide_closeicon",b.getAction("delete")),i.on("dblclick","a",b.getAction("rename")),F.on("dblclick","a",b.getAction("rename"))},A(),ce=l.width(),ue(),setInterval(ue,1e3),f.resetModified(),pe.requestAction("load","loading",u,u.loadajaxurl).done(function(e){for(var t=!0,i=e.files,n=!1,l=0;l<i.length;l++){var o=i[l],o=f.addFile(o,!1,p,C);o?(o.resetModified(),l<g||i.length<=5?f.open(o):n=!0):t=!1}r.tabs("option","active",0),e.compilationexecution&&h.setResult(e.compilationexecution,!1),b.setTimeLeft(e),""<e.comments&&fe("#vpl_ide_input_comments").val(e.comments),t?f.resetModified():f.setModified(),0===f.length()&&0<v?b.getAction("new")():u.saved||f.setModified(),f.setFontSize(u.fontSize),f.setVersion(e.version),f.fileListVisible(n),pe.afterAll("AfterLoadFiles",function(){p(),A(),M(!0)})}).fail(C)};return window.VPLIDE=i,{init:function(e,t){_e=new i(e,t)}}});
//# sourceMappingURL=vplide.min.js.map